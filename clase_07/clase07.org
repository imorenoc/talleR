#+title: Taller de R. Clase 07
#+author: Dr. Isaías Moreno Cruz
#+email: ismoc@cio.mx
#+date: 14-10-2024
#+latex_header: \mode<beamer>{\usetheme{Madrid}}

* Lattice

#+begin_src R :results output :session curso :exports both
  library(lattice)
  data(environmental)
  df <- environmental
  head(df)
#+end_src

#+RESULTS:
:   ozone radiation temperature wind
: 1    41       190          67  7.4
: 2    36       118          72  8.0
: 3    12       149          74 12.6
: 4    18       313          62 11.5
: 5    23       299          65  8.6
: 6    19        99          59 13.8

** xyplot

#+begin_src R :file ./fig/xyplot.png :results file graphics :session curso :exports both
xyplot(ozone ~ radiation, data=df, main="Ozone vs. Radiation")
#+end_src

#+RESULTS:
[[file:./fig/xyplot.png]]
#+begin_src R :file ./fig/xyplot2.png :results file graphics :session curso :exports both
  temp.cut <- equal.count(df$temperature, 4)
  xyplot(ozone ~ radiation | temp.cut, data=df)
#+end_src

#+RESULTS:
[[file:./fig/xyplot2.png]]
#+begin_src R :file ./fig/xyplot3.png :results file graphics :session curso :exports both
  xyplot(ozone ~ radiation | temp.cut, data=df, layout=c(1,4))
#+end_src

#+RESULTS:
[[file:./fig/xyplot3.png]]
** Panel

#+begin_src R :file ./fig/xyplotPanel.png :results file graphics :session curso :exports both
    xyplot(ozone ~ radiation | temp.cut, data=df,
	   panel = function(x,y, ...){
	     panel.xyplot(x,y,...)
	     fit <- lm(y~x)
	     panel.abline(fit)
	   }, xlab = "Solar Radiation", ylab="Ozone(ppb)",
	   main = "Ozone Vs. Solar Radiation")
#+end_src

#+RESULTS:
[[file:./fig/xyplotPanel.png]]
** splom

#+begin_src R :file ./fig/splom.png :results file graphics :session curso :exports both
splom(~df)
#+end_src

#+RESULTS:
[[file:./fig/splom.png]]
** histogram

#+begin_src R :file ./fig/histogram.png :results file graphics :session curso :exports both
  histogram(~temperature, data=df)
#+end_src

#+RESULTS:
[[file:./fig/histogram.png]]
#+begin_src R :file ./fig/histogram2.png :results file graphics :session curso :exports both
  wind.cut <- equal.count(df$wind,4)
  
  histogram(~ozone | wind.cut, data=df)
#+end_src

#+RESULTS:
[[file:./fig/histogram2.png]]

* ggplot2

#+begin_src R :results output :session curso :exports both
  library(ggplot2)
  df <- data.frame(mpg)
  head(df)
#+end_src

#+RESULTS:
:   manufacturer model displ year cyl      trans drv cty hwy fl   class
: 1         audi    a4   1.8 1999   4   auto(l5)   f  18  29  p compact
: 2         audi    a4   1.8 1999   4 manual(m5)   f  21  29  p compact
: 3         audi    a4   2.0 2008   4 manual(m6)   f  20  31  p compact
: 4         audi    a4   2.0 2008   4   auto(av)   f  21  30  p compact
: 5         audi    a4   2.8 1999   6   auto(l5)   f  16  26  p compact
: 6         audi    a4   2.8 1999   6 manual(m5)   f  18  26  p compact

** qplot

#+begin_src R :file ./fig/qplot.png :results file graphics :session curso :exports both
qplot(displ, hwy, data=mpg)
#+end_src

#+RESULTS:
[[file:./fig/qplot.png]]

#+begin_src R :file ./fig/qplot2.png :results file graphics :session curso :exports both
qplot(displ, hwy, data=mpg, color=drv)
#+end_src

#+RESULTS:
[[file:./fig/qplot2.png]]

#+begin_src R :file ./fig/qplot3.png :results file graphics :session curso :exports both
qplot(displ, hwy, data=mpg, geom=c("point", "smooth"))
#+end_src

#+RESULTS:
[[file:./fig/qplot3.png]]

#+begin_src R :file ./fig/qplot4.png :results file graphics :session curso :exports both
qplot(hwy, data=mpg, fill=drv)
#+end_src

#+RESULTS:
[[file:./fig/qplot4.png]]
#+begin_src R :file ./fig/qplot5.png :results file graphics :session curso :exports both
qplot(displ, hwy, data=mpg, facets=.~drv)
#+end_src

#+RESULTS:
[[file:./fig/qplot5.png]]


#+begin_src R :file ./fig/qplot6.png :results file graphics :session curso :exports both
qplot(hwy, data=mpg, facets=drv~., binwidth=2)
#+end_src

#+RESULTS:
[[file:./fig/qplot6.png]]

** ggplot

2 -8 Plotting with ggplot2

#+begin_src R :results output :session curso :exports both
  library(ggplot2)
  df <- data.frame(mpg)
  head(df)
#+end_src

#+RESULTS:
:   manufacturer model displ year cyl      trans drv cty hwy fl   class
: 1         audi    a4   1.8 1999   4   auto(l5)   f  18  29  p compact
: 2         audi    a4   1.8 1999   4 manual(m5)   f  21  29  p compact
: 3         audi    a4   2.0 2008   4 manual(m6)   f  20  31  p compact
: 4         audi    a4   2.0 2008   4   auto(av)   f  21  30  p compact
: 5         audi    a4   2.8 1999   6   auto(l5)   f  16  26  p compact
: 6         audi    a4   2.8 1999   6 manual(m5)   f  18  26  p compact


#+begin_src R :file ./fig/ggplot.png :results file graphics :session curso :exports both
  g <- ggplot(df, aes(x=displ, y=hwy))
  g + geom_point()
#+end_src

#+RESULTS:
[[file:./fig/ggplot.png]]


#+begin_src R :file ./fig/ggplot2.png :results file graphics :session curso :exports both
  g <- ggplot(df, aes(x=displ, y=hwy))
  g + geom_point() + geom_smooth()
#+end_src

#+RESULTS:
[[file:./fig/ggplot2.png]]

#+begin_src R :file ./fig/ggplot3.png :results file graphics :session curso :exports both
  g <- ggplot(df, aes(x=displ, y=hwy))
  g + geom_point() + geom_smooth(method="lm")
#+end_src

#+RESULTS:
[[file:./fig/ggplot3.png]]
#+begin_src R :file ./fig/ggplot4.png :results file graphics :session curso :exports both
  g <- ggplot(df, aes(x=displ, y=hwy))
  g + geom_point() + facet_grid(.~drv) + geom_smooth(method= "lm")
#+end_src

#+RESULTS:
[[file:./fig/ggplot4.png]]
** Modificaciones est'eticas

#+begin_src R :file ./fig/ggplot5.png :results file graphics :session curso :exports both
  g <- ggplot(df, aes(x=displ, y=hwy))
  g + geom_point(color="steelblue", size=4, alpha=1/2)
#+end_src

#+RESULTS:
[[file:./fig/ggplot5.png]]
#+begin_src R :file ./fig/ggplot6.png :results file graphics :session curso :exports both
  g <- ggplot(df, aes(x=displ, y=hwy))
  g + geom_point( aes(color= drv), size=4, alpha=1/2)
#+end_src

#+RESULTS:
[[file:./fig/ggplot6.png]]
** Labels


#+begin_src R :file ./fig/ggplot7.png :results file graphics :session curso :exports both
    g <- ggplot(df, aes(x=displ, y=hwy))
    g + geom_point( aes(color= drv), size=4, alpha=1/2) +
      labs(title="My Title") + labs(x="x label", y = "y label")
#+end_src

#+RESULTS:
[[file:./fig/ggplot7.png]]
** Notas sobre los limites

#+begin_src R :results none :session curso :exports both
  testdat <- data.frame(x=1:100, y=rnorm(100))
  testdat[50, 2] <- 100 ## outlier
#+end_src


#+begin_src R :file ./fig/ggplotLimits.png :results file graphics :session curso :exports both
  par( mfrow=c(1,2))
  plot(testdat$x, testdat$y, type='l')
  plot(testdat$x, testdat$y, type='l', ylim=c(-3,3))
  par(mfrow=c(1,1))
#+end_src

#+RESULTS:
[[file:./fig/ggplotLimits.png]]

#+begin_src R :file ./fig/ggplotLimits2.png :results file graphics :session curso :exports both
  g <- ggplot(testdat, aes(x=x, y=y))
  g + geom_line()
  #g + geom_line() + ylim(-3,3)
#+end_src

#+RESULTS:
[[file:./fig/ggplotLimits2.png]]
#+begin_src R :file ./fig/ggplotLimits3.png :results file graphics :session curso :exports both
  g <- ggplot(testdat, aes(x=x, y=y))
  g + geom_line() + ylim(-3,3)
#+end_src

#+RESULTS:
[[file:./fig/ggplotLimits3.png]]
#+begin_src R :file ./fig/ggplotLimits4.png :results file graphics :session curso :exports both
  g <- ggplot(testdat, aes(x=x, y=y))
  g + geom_line() + coord_cartesian(ylim=c(-3,3))
#+end_src

#+RESULTS:
[[file:./fig/ggplotLimits4.png]]

* Anotaciones Matemáticas

R puede producir símbolos en LaTeX en las anotaciones de gráficas.

- Los símbolos matemáticos están dados por la función "expressions"
- Existe una lista de símbolos en la documentación ?plotmath

#+begin_src R :file ./fig/expression.png :results file graphics :session curso :exports both
    plot(0,0, main=expression(theta ==0),
	 ylab = expression(hat(gamma) == 0),
	 xlab = expression(sum(x[i] * y [i], i==0, n)))
#+end_src

#+RESULTS:
[[file:./fig/expression.png]]


#+begin_src R :file ./fig/expression2.png :results file graphics :session curso :exports both
  x <- rnorm(100)
  hist(x,
       xlab=expression("The mean (" * bar(x) * ") is " * sum(x[i]/n,i==1,n)))
#+end_src

#+RESULTS:
[[file:./fig/expression2.png]]
* Reproducible Research


** knitr 

Knitr es un paquete escrito pot Yihui Xie

- Soporta RMarkdown, LaTeX y HTML
- Exporta a PDF, HTML
- Bien soportado en RStudio

- Knitr

file:markdown.Rmd

file:LaTeX.Rnw

file.org
